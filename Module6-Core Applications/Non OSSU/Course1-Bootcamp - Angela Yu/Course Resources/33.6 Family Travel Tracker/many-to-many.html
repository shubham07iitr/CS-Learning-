<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Many-to-Many Relationship</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 40px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .container {
            display: flex;
            justify-content: space-around;
            margin-top: 40px;
            gap: 30px;
            align-items: center;
        }
        .table-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            flex: 1;
        }
        .junction-container {
            background: #fff3cd;
            border: 3px solid #ffc107;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            flex: 1;
        }
        h2 {
            color: #2c3e50;
            border-bottom: 3px solid #9b59b6;
            padding-bottom: 10px;
        }
        .junction-container h2 {
            color: #e67e22;
            border-bottom: 3px solid #e67e22;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th {
            background-color: #9b59b6;
            color: white;
            padding: 12px;
            text-align: left;
        }
        .junction-container th {
            background-color: #e67e22;
        }
        td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        tr:hover {
            background-color: #f8f9fa;
        }
        .primary-key {
            background-color: #ffe5b4;
            font-weight: bold;
        }
        .foreign-key {
            background-color: #d4edda;
            font-weight: bold;
        }
        .relationship {
            text-align: center;
            padding: 20px;
            font-size: 24px;
            color: #9b59b6;
            font-weight: bold;
        }
        .explanation {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .key-legend {
            margin-top: 20px;
            padding: 15px;
            background: #ecf0f1;
            border-radius: 5px;
        }
        .key-legend span {
            display: inline-block;
            padding: 5px 10px;
            margin: 5px;
            border-radius: 3px;
        }
        .legend-pk {
            background-color: #ffe5b4;
        }
        .legend-fk {
            background-color: #d4edda;
        }
        .legend-junction {
            background-color: #fff3cd;
            border: 2px solid #ffc107;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .bad-example, .good-example {
            padding: 15px;
            border-radius: 8px;
        }
        .bad-example {
            background-color: #fee;
            border: 2px solid #e74c3c;
        }
        .good-example {
            background-color: #efe;
            border: 2px solid #27ae60;
        }
        .stats {
            background: #3498db;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 14px;
        }
        .highlight {
            background-color: #fff3cd;
            padding: 3px 6px;
            border-radius: 3px;
            font-weight: bold;
        }
        .note {
            background: #e8f4f8;
            border-left: 5px solid #3498db;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <h1>Many-to-Many (M:N) Relationship Example</h1>
    
    <div class="container">
        <div class="table-container">
            <h2>Students Table</h2>
            <table>
                <thead>
                    <tr>
                        <th>student_id (PK)</th>
                        <th>name</th>
                        <th>email</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="primary-key">1</td>
                        <td>Alice</td>
                        <td>alice@uni.edu</td>
                    </tr>
                    <tr>
                        <td class="primary-key">2</td>
                        <td>Bob</td>
                        <td>bob@uni.edu</td>
                    </tr>
                    <tr>
                        <td class="primary-key">3</td>
                        <td>Charlie</td>
                        <td>charlie@uni.edu</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="relationship">‚Üî<br>M:N</div>

        <div class="junction-container">
            <h2>Enrollments (Junction Table)</h2>
            <table>
                <thead>
                    <tr>
                        <th>enrollment_id</th>
                        <th>student_id (FK)</th>
                        <th>course_id (FK)</th>
                        <th>grade</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td class="foreign-key">1</td>
                        <td class="foreign-key">101</td>
                        <td>A</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td class="foreign-key">1</td>
                        <td class="foreign-key">102</td>
                        <td>B+</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td class="foreign-key">2</td>
                        <td class="foreign-key">101</td>
                        <td>A-</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td class="foreign-key">2</td>
                        <td class="foreign-key">103</td>
                        <td>B</td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td class="foreign-key">3</td>
                        <td class="foreign-key">102</td>
                        <td>A</td>
                    </tr>
                    <tr>
                        <td>6</td>
                        <td class="foreign-key">3</td>
                        <td class="foreign-key">103</td>
                        <td>A+</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="relationship">‚Üî<br>M:N</div>

        <div class="table-container">
            <h2>Courses Table</h2>
            <table>
                <thead>
                    <tr>
                        <th>course_id (PK)</th>
                        <th>name</th>
                        <th>credits</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="primary-key">101</td>
                        <td>Database Systems</td>
                        <td>4</td>
                    </tr>
                    <tr>
                        <td class="primary-key">102</td>
                        <td>Web Development</td>
                        <td>3</td>
                    </tr>
                    <tr>
                        <td class="primary-key">103</td>
                        <td>Data Structures</td>
                        <td>4</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="key-legend">
        <strong>Legend:</strong>
        <span class="legend-pk">Primary Key (PK)</span>
        <span class="legend-fk">Foreign Key (FK)</span>
        <span class="legend-junction">Junction/Bridge Table</span>
    </div>

    <div class="note">
        <strong>What the data shows:</strong>
        <ul>
            <li>Alice is in Database Systems (A) and Web Development (B+)</li>
            <li>Bob is in Database Systems (A-) and Data Structures (B)</li>
            <li>Charlie is in Web Development (A) and Data Structures (A+)</li>
        </ul>
    </div>

    <div class="explanation">
        <h2>What is a Many-to-Many Relationship?</h2>
        <p>A <strong>many-to-many (M:N)</strong> relationship means:</p>
        <ul>
            <li>One student can enroll in <strong>many courses</strong></li>
            <li>One course can have <strong>many students</strong></li>
        </ul>

        <h3>How it works:</h3>
        <p>You <strong>cannot store M:N directly</strong> in two tables - you need a <strong>junction table</strong>!</p>
        <p>The Enrollments table has two foreign keys:</p>
        <ul>
            <li><code>student_id</code> ‚Üí References Students table</li>
            <li><code>course_id</code> ‚Üí References Courses table</li>
        </ul>

        <h2 style="color: #e74c3c; margin-top: 40px;">‚ö° Why We NEED Junction Tables (Computing Perspective)</h2>
        
        <div class="comparison">
            <div class="bad-example">
                <h3>‚ùå BAD: Store as Text</h3>
                <table style="font-size: 11px;">
                    <tr>
                        <th>student_id</th>
                        <th>name</th>
                        <th>courses</th>
                    </tr>
                    <tr>
                        <td>1</td>
                        <td>Alice</td>
                        <td>"DB,Web"</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>Bob</td>
                        <td>"DB,DS"</td>
                    </tr>
                </table>
                
                <div class="stats">
                    ‚ùå Can't query "students in DB Systems"<br>
                    ‚ùå Can't JOIN with courses table<br>
                    ‚ùå Can't store grades<br>
                    ‚ùå String parsing nightmare
                </div>
            </div>

            <div class="bad-example">
                <h3>‚ùå BAD: Duplicate Everything</h3>
                <table style="font-size: 11px;">
                    <tr>
                        <th>course</th>
                        <th>student</th>
                        <th>email</th>
                    </tr>
                    <tr>
                        <td>DB Systems</td>
                        <td>Alice</td>
                        <td>alice@uni.edu</td>
                    </tr>
                    <tr>
                        <td>Web Dev</td>
                        <td>Alice</td>
                        <td>alice@uni.edu</td>
                    </tr>
                </table>
                
                <div class="stats">
                    ‚ùå Massive duplication<br>
                    ‚ùå Update nightmare<br>
                    ‚ùå Inconsistency risk<br>
                    ‚ùå Wasted storage
                </div>
            </div>
        </div>

        <div class="good-example" style="margin-top: 20px;">
            <h3>‚úÖ GOOD: Junction Table Solution</h3>
            <ul>
                <li>Students: 3 rows (data stored once)</li>
                <li>Courses: 3 rows (data stored once)</li>
                <li>Enrollments: 6 rows (just relationships + grade)</li>
            </ul>
            <div class="stats">
                ‚úÖ No duplication<br>
                ‚úÖ Fast queries both directions<br>
                ‚úÖ Easy updates (1 place)<br>
                ‚úÖ Store relationship data<br>
                ‚úÖ Data integrity enforced
            </div>
        </div>

        <h3 style="margin-top: 30px;">üöÄ Computing Benefits of M:N with Junction Table:</h3>

        <h4>1. <span class="highlight">Eliminates Data Duplication</span></h4>
        <pre>Scenario: 10,000 students, 500 courses, avg 5 courses per student = 50,000 enrollments

‚ùå Without junction: Course names repeated 50,000 times √ó 30 bytes = 1.5 MB
‚úÖ With junction: Courses stored once (500 rows) + 50K enrollments (8 bytes each) = 400 KB

Savings: 73% less storage!</pre>

        <h4>2. <span class="highlight">Fast Queries (Both Directions!)</span></h4>
        <pre>-- Find Alice's courses (forward direction)
SELECT c.name FROM courses c
JOIN enrollments e ON c.course_id = e.course_id
WHERE e.student_id = 1;

-- Find students in Database Systems (reverse direction)
SELECT s.name FROM students s
JOIN enrollments e ON s.student_id = e.student_id
WHERE e.course_id = 101;

Both queries use indexes ‚Üí O(log n) lookup speed!</pre>

        <h4>3. <span class="highlight">Update Efficiency</span></h4>
        <pre>Scenario: Change course name "Database Systems" ‚Üí "Advanced Databases"

‚ùå Without junction: Update 1000s of rows where course name appears
‚úÖ With junction: Update 1 row in Courses table

-- Just one update!
UPDATE courses SET name = 'Advanced Databases' WHERE course_id = 101;
-- All enrollments automatically reflect the change (via JOIN)</pre>

        <h4>4. <span class="highlight">Store Relationship-Specific Data</span></h4>
        <p>The junction table stores data <strong>about the relationship itself</strong>:</p>
        <ul>
            <li><code>grade</code> - What grade did this student get in this course?</li>
            <li><code>enrollment_date</code> - When did they enroll?</li>
            <li><code>status</code> - Active, dropped, completed?</li>
        </ul>
        <p>This data doesn't belong in Students or Courses - it's <strong>relationship data</strong>!</p>

        <h4>5. <span class="highlight">Data Integrity with Foreign Keys</span></h4>
        <pre>-- Try to enroll non-existent student:
INSERT INTO enrollments (student_id, course_id) VALUES (999, 101);
ERROR: Foreign key violation! ‚úÖ

-- Try to delete a course that has students:
DELETE FROM courses WHERE course_id = 101;
ERROR: Cannot delete (students enrolled)! ‚úÖ
-- Must handle enrollments first (drop students or cascade delete)</pre>

        <h4>6. <span class="highlight">Real Performance Numbers</span></h4>
        <div style="background: #fff3cd; padding: 15px; border-radius: 5px; border-left: 5px solid #ffc107;">
            <strong>Example: University with 50,000 students, 2,000 courses</strong>
            <ul>
                <li>Average 6 courses per student = 300,000 enrollments</li>
            </ul>
            
            <strong>Without junction (store course names in Students table):</strong>
            <ul>
                <li>Storage: 15 MB (course names repeated)</li>
                <li>Query "students in CS101": Scan all 50,000 students, parse course strings</li>
                <li>Update course name: Text search + replace across 10,000 students = slow!</li>
            </ul>
            
            <strong>With junction table:</strong>
            <ul>
                <li>Storage: 2.4 MB (just IDs)</li>
                <li>Query: Index lookup on course_id ‚Üí O(log n) + join</li>
                <li>Update: 1 row update in Courses table</li>
                <li><strong>Result: 6√ó less storage, 100√ó faster queries!</strong></li>
            </ul>
        </div>

        <h3 style="margin-top: 30px;">SQL to Create M:N Relationship:</h3>
        <pre>CREATE TABLE students (
    student_id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    email VARCHAR(100)
);

CREATE TABLE courses (
    course_id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    credits INT
);

-- Junction table connects the two
CREATE TABLE enrollments (
    enrollment_id SERIAL PRIMARY KEY,
    student_id INT,
    course_id INT,
    grade VARCHAR(2),              -- Relationship-specific data
    enrollment_date DATE,          -- Relationship-specific data
    FOREIGN KEY (student_id) REFERENCES students(student_id),
    FOREIGN KEY (course_id) REFERENCES courses(course_id),
    UNIQUE(student_id, course_id)  -- Prevent duplicate enrollments
);

-- Indexes for fast lookups (critical for performance!)
CREATE INDEX idx_enrollments_student ON enrollments(student_id);
CREATE INDEX idx_enrollments_course ON enrollments(course_id);</pre>

        <h3>Real-world Examples of M:N Relationships:</h3>
        <ul>
            <li><strong>Movies ‚Üî Actors</strong> (one movie has many actors, one actor in many movies) ‚Üí Junction: Cast</li>
            <li><strong>Products ‚Üî Orders</strong> (one order has many products, one product in many orders) ‚Üí Junction: Order_Items</li>
            <li><strong>Tags ‚Üî Blog Posts</strong> (one post has many tags, one tag on many posts) ‚Üí Junction: Post_Tags</li>
            <li><strong>Doctors ‚Üî Patients</strong> (one doctor treats many patients, one patient sees many doctors) ‚Üí Junction: Appointments</li>
            <li><strong>Skills ‚Üî Employees</strong> (one employee has many skills, one skill possessed by many employees) ‚Üí Junction: Employee_Skills</li>
        </ul>

        <div class="note" style="margin-top: 30px;">
            <strong>üí° Key Takeaway:</strong> Junction tables are NOT just a theoretical concept - they're a 
            <strong>critical performance optimization</strong> that prevents data duplication, enables efficient 
            bidirectional queries, maintains data integrity, and scales to millions of records. Without them, 
            M:N relationships would be a maintenance and performance nightmare!
        </div>
    </div>
</body>
</html>